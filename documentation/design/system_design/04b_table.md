## R1: The system shall implement git and git-lfs repositories over SSH.

| status | id      | description                                                                                                                                                                                                                                                                                                                                                          | Satisfied by function | Implemented by component |
| ------ | ------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------- | ------------------------ |
| ‚úÖ     | R1.1    | The system shall serve all regular git commands (clone, push, pull, etc.).                                                                                                                                                                                                                                                                                           | F1.2, F3              | Git server               |
| ‚úÖ     | R1.2    | The system shall allow for SSH git authentication.                                                                                                                                                                                                                                                                                                                   | F1.1                  | sshd, gitolite           |
| ‚úÖ     | R1.3    | The system shall implement the git-lfs batch/objects API.                                                                                                                                                                                                                                                                                                            | F1.3                  | git lfs server           |
| ‚úÖ     | R1.3.1  | the server shall accept a get request on route /objects/batch?repo=... with payload matching the payload from [https://github.com/git-lfs/git-lfs/blob/main/docs/api/batch.md#requests](https://github.com/git-lfs/git-lfs/blob/main/docs/api/batch.md#requests)                                                                                                     |                       |                          |
| ‚úÖ     | R1.3.2  | the server shall return for route objects_batch the operation, the hash_algo, and an array of objects containing presigned links to perform a download/upload operation, according to the [https://github.com/git-lfs/git-lfs/blob/main/docs/api/batch.md#successful-responses](https://github.com/git-lfs/git-lfs/blob/main/docs/api/batch.md#successful-responses) |                       |                          |
| ‚úÖ     | R1.3.3  | In case of error generating the link, the error returned should be embedded into the response (the request shall not fail) according to the [https://github.com/git-lfs/git-lfs/blob/main/docs/api/batch.md#successful-responses](https://github.com/git-lfs/git-lfs/blob/main/docs/api/batch.md#successful-responses). The error shall be one of                    |                       |                          |
| ‚úÖ     | R1.3.4  | In case of failure leading to global failure of the request, the server shall return the appropriate HTTP status code and a json object containing a message property. Only the following errors shall happen:                                                                                                                                                       |                       |                          |
| ‚úÖ     | R1.4    | The system shall implement the git-lfs locks API.                                                                                                                                                                                                                                                                                                                    | F1.4                  | Git lfs server           |
| ‚úÖ     | R1.4.1  | the server shall expose a `POST /locks` route, accepting a payload with a repo name, a path, and a ref, that create a lock for the path, the ref, and the repo, and mark user as the owner of the lock.                                                                                                                                                              |                       |                          |
| ‚úÖ     | R1.4.2  | the server shall respond to a lock creation either by returning the lock, by a "bad response, lock exists" response, including the existing lock                                                                                                                                                                                                                     |                       |                          |
| ‚úÖ     | R1.4.3  | the server shall expose a `GET /locks` route, accepting a payload with optional paths, id, refspec; it shall match all corresponding locks and return them.                                                                                                                                                                                                          |                       |                          |
| ‚úÖ     | R1.4.4  | the server shall expose a `POST /locks/verify` route, accepting a payload with an optional ref name, and locks separated between _ours_ (the locks of user) and _theirs_ (the locks of teammates)                                                                                                                                                                    |                       |                          |
| ‚úÖ     | R1.4.5  | the server shall accept cursor, limit in the `GET /locks` and `POST /locks/verify` payload, so it selects at most _limit_ locks, starting at _cursor_. It shall return the next cursor if there are more than _limit_ locks                                                                                                                                          |                       |                          |
| ‚úÖ     | R1.4.6  | the server shall expose a `POST /locks/:id/unlock`, that delete the lock by id and return it.                                                                                                                                                                                                                                                                        |                       |                          |
| ‚úÖ     | R1.4.7  | the server shall verify that user deleting a lock is owner of the lock. If he is not, the deletion shall only occur if an attribute `force:true` is passed in the payload.                                                                                                                                                                                           |                       |                          |
| ‚úÖ     | R1.4.8  | the server shall verify that user has the right to write the repository, checking for the json web token                                                                                                                                                                                                                                                             |                       |                          |
| ‚úÖ     | R1.4.9  | for all routes, in the event of an error, the server shall return an error response as a JSON containing a message property.                                                                                                                                                                                                                                         |                       |                          |
| ‚úÖ     | R1.4.10 | any route shall respect the schemas defined in the [https://github.com/git-lfs/git-lfs/blob/main/docs/api/locking.md](https://github.com/git-lfs/git-lfs/blob/main/docs/api/locking.md)                                                                                                                                                                              |                       |                          |

## R2: The system shall be usable as a low-level foundation for commercial and non-commercial multi-users applications based around git repositories.

| status | id     | description                                                                                                                                                                                                                                               | Satisfied by function | Implemented by component |
| ------ | ------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------- | ------------------------ |
| ‚úÖ     | R2.1   | The system shall allow for per-repository access control, including read and write access.                                                                                                                                                                | F2                    | Gitolite                 |
| ‚úÖ     | R2.1.1 | The authentication and authorization subsystem shall be able to verify if a given user has read or write access to a given repository.                                                                                                                    |                       |                          |
| ‚úÖ     | R2.1.2 | The authentication and authorization subsystem shall expose a command named _git-lfs-authenticate_, which will return a json web token signing the user, the repository, the operation, and the expiration date.                                          |                       |                          |
| ‚úÖ     | R2.1.3 | The lfs server shall accept and verify a json web token signing the user, the repository, the operation, and the expiration date.                                                                                                                         | F5.1                  |                          |
| ‚úÖ     | R2.1.4 | The lfs server shall be able to generate a signed link for a given file, operation, and expiration date that can't be modified by the user.                                                                                                               | F5.2                  |                          |
| ‚úÖ     | R2.1.5 | The file server (either the lsf info server acting as a proxy or the storage server directly) shall be able to verify a signed link for a given file, operation, and expiration date, and serve or accept the requested file, depending on the operation. | F5.3                  |                          |
| 3/4    | R2.2   | The system shall store data files in a separate storage location.                                                                                                                                                                                         |                       | Postgres, Minio          |
| ‚úÖ     | R2.2.1 | The system shall implement the storage interfaces of **R2.3.1** for the MinIO API, using a Single Bucket Storage policy (SBS)                                                                                                                             | F6                    |                          |
| ‚úÖ     | R2.2.2 | The system shall implement the storage interfaces of **R2.3.1** for the local file system API                                                                                                                                                             | F6                    |                          |
| üö´     | R2.2.3 | The system shall implement the lock storage interfaces of **R2.3.3** for the MinIO API, using a Single Bucket Storage policy (SBS)                                                                                                                        | F4                    |                          |
| ‚úÖ     | R2.2.4 | The system shall implement the lock storage interfaces of **R2.3.3** for postgresql database                                                                                                                                                              | F4                    |                          |
| 2/4    | R2.3   | Components of the system shall be reusable in other systems.                                                                                                                                                                                              |                       |                          |
| ‚úÖ     | R2.3.1 | The system shall define file storage interfaces, to retrieve metadata about a file, to retrieve a file, and to store a file.                                                                                                                              | F6                    |                          |
| ‚ùå     | R2.3.2 | The system shall model implementations of the storage interfaces of **R2.3.1** for other storages: Multiple Bucket Storage policy (MBS), and File Transfer Protocol (FTP), and local storage with database stored metadata (LSDB)                         | F6                    |                          |
| ‚úÖ     | R2.3.3 | The system shall define lock storage interfaces, to create, list, and delete locks.                                                                                                                                                                       | F4                    |                          |
| üö´     | R2.3.4 | The system shall model implementations of the lock storage interfaces of **R2.3.3** for other storages: Locks in multiple buckets (LMB), Locks in local file storage.                                                                                     | F4                    |                          |
| ‚úÖ     | R2.4   | The system repositories and users shall be configurable by a single administrator actor (other authorized system or actual person).                                                                                                                       | F7                    | Gitolite                 |
| ‚úÖ     | R2.5   | The system shall use compatible licences, and be loosely coupled enough so the licences of components do not contaminate each other.                                                                                                                      |                       |                          |
| ‚úÖ     | R2.6   | The system shall not use deprecated components.                                                                                                                                                                                                           |                       |                          |
| ‚úÖ     | R2.7   | Abstraction done of the network layer between the client and the system, the system shall handle an initial push of a 100MB of LFS as 100 large files in less than one minute.                                                                            |                       |                          |

## R3: The system shall be developed in 200 hours-man by the end of October 2023, and require at most 100 hours-man per year to be maintained by the community.

| status | id     | description                                                                                                                                                                                                                                                                                                                                         | Satisfied by function | Implemented by component                 |
| ------ | ------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------- | ---------------------------------------- |
| ‚úÖ     | R3.1   | The system shall ensure memory safety and functional correctness either by being heavily maintained by the community, by formal technics, or by automated testing.                                                                                                                                                                                  |                       |                                          |
| ‚úÖ     | R3.1.1 | Custom parts of the system shall be implemented in the rust programming language.                                                                                                                                                                                                                                                                   |                       | git-lfs-authenticate command; lfs server |
| ‚úÖ     | R3.1.2 | Non custom parts of the system shall be heavily adopted by the community to be considered safe.                                                                                                                                                                                                                                                     |                       | gitolite, git, nginx, ...                |
| ‚úÖ     | R3.1.3 | Custom parts of the system shall be tested using automated testing, with a coverage of at least 90\%.                                                                                                                                                                                                                                               |                       | git-lfs-authenticate command; lfs server |
| ‚úÖ     | R3.2   | Every custom code shall adhere to a common and well-recognized good practices handbook, to be chosen.                                                                                                                                                                                                                                               |                       | git-lfs-authenticate command; lfs server |
| ‚úÖ     | R3.2.1 | Custom apis of the system should adhere to the following good practices handbooks [https://rust-lang.github.io/api-guidelines/](https://rust-lang.github.io/api-guidelines/), [https://cheats.rs/#idiomatic-rust](https://cheats.rs/#idiomatic-rust) and [https://rust-unofficial.github.io/patterns/](https://rust-unofficial.github.io/patterns/) |                       |                                          |
| ‚úÖ     | R3.2.2 | Custom code of the system shall use the linter [https://github.com/rust-lang/rust-clippy](https://github.com/rust-lang/rust-clippy)                                                                                                                                                                                                                 |                       |                                          |
| ‚úÖ     | R3.3   | The system shall be documented focussing on: the system in its whole, the system components, maintenance processes.                                                                                                                                                                                                                                 |                       |                                          |
| ‚úÖ     | R3.3.1 | Every custom and non-custom code of the system shall be documented in term of context and role in the system, and in term of possible replacements.                                                                                                                                                                                                 |                       |                                          |
| ‚úÖ     | R3.3.2 | The system shall be documented in term of architecture, and in term of maintenance processes.                                                                                                                                                                                                                                                       |                       |                                          |
| ‚úÖ     | R3.3.3 | The system shall be documented in term of deployment processes.                                                                                                                                                                                                                                                                                     |                       |                                          |
| ‚úÖ     | R3.3.4 | Custom code of the system shall be documented in term of technical choices and design.                                                                                                                                                                                                                                                              |                       |                                          |

## R4: The system shall be deployable in less than 1h in an enterprise-grade environment.

| status | id   | description                                                                                                                                                                                                                   | Satisfied by function | Implemented by component                 |
| ------ | ---- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------- | ---------------------------------------- |
| ‚úÖ     | R4.1 | The system shall be deployable in conteneurised linux environments in a reproducible and documented way.                                                                                                                      |                       | Docker, docker-compose                   |
| ‚úÖ     | R4.2 | Only the lock API, the batch API, and the git commands shall be exposed to the outside.                                                                                                                                       |                       | Nginx                                    |
| ‚úÖ     | R4.3 | The authorization systems shall not share state between the git server and the git-lfs server or the storage server.                                                                                                          |                       | git-lfs authenticate command, lfs server |
| ‚ùå     | R4.4 | The administrator of the system shall be able to define resource limits for the bandwidth, the storage, and the number of requests, separated between the target points (lfs, git), and discriminated by user and repository. |                       |                                          |
| ‚ùå     | R4.5 | The system shall do regular backups of the data.                                                                                                                                                                              |                       |
